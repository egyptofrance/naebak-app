# ุฎุทุฉ ุชูููุฐ v1.3.0: ูุธุงู ุงููููุงุช ุงูุดุฎุตูุฉ ูุงูุชุญุณููุงุช

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุฐู ุงููุฑุญูุฉ ุชุชุถูู ุชุทููุฑ ูุธุงู ูุงูู ูููููุงุช ุงูุดุฎุตูุฉ ูุน ุชุญุฏูุซุงุช ูุจูุฑุฉ ุนูู ูููุฐุฌ ุงูุชุณุฌูู ูHeader. ูุธุฑุงู ูุญุฌู ุงูุนูู ุงููุจูุฑุ ุณูุชู ุชูุณููู ุฅูู ูุฑุงุญู ุตุบูุฑุฉ ูุงุจูุฉ ููุชูููุฐ.

---

## ๐ฏ ุงูุฃูุฏุงู ุงูุฑุฆูุณูุฉ

1. **ุชุญุฏูุซ ูููุฐุฌ ุงูุชุณุฌูู** ูุฏุนู 3 ุฃููุงุน ูู ุงูุญุณุงุจุงุช
2. **ุชุญุฏูุซ Header** ููุนุฑุถ ุงุณู ุงููุณุชุฎุฏู ููุงุฆูุฉ ููุณุฏูุฉ
3. **ุฅูุดุงุก ุตูุญุงุช ูููุงุช ุดุฎุตูุฉ** ููู ููุน ูุณุชุฎุฏู
4. **ุฅูุดุงุก ููุญุงุช ุชุญูู** ูุฎุตุตุฉ ููู ุฏูุฑ

---

## ๐ ุชูุฏูุฑ ุงูููุช ูุงูุฌูุฏ

| ุงููุฑุญูุฉ | ุงูููุช ุงููุชููุน | ุงูุตุนูุจุฉ |
|---------|---------------|---------|
| ุชุญุฏูุซ ูููุฐุฌ ุงูุชุณุฌูู | 2-3 ุณุงุนุงุช | ูุชูุณุทุฉ |
| ุชุญุฏูุซ Header | 1 ุณุงุนุฉ | ุณููุฉ |
| ุตูุญุงุช ุงููููุงุช ุงูุดุฎุตูุฉ | 3-4 ุณุงุนุงุช | ูุชูุณุทุฉ |
| ููุญุงุช ุงูุชุญูู | 4-5 ุณุงุนุงุช | ุตุนุจุฉ |
| **ุงููุฌููุน** | **10-13 ุณุงุนุฉ** | **ูุชูุณุทุฉ-ุตุนุจุฉ** |

---

## ๐ ุงููุฑุญูุฉ 1: ุชุญุฏูุซ ูููุฐุฌ ุงูุชุณุฌูู (2-3 ุณุงุนุงุช)

### 1.1. ุชุญุฏูุซ `RegisterForm.tsx`

#### ุงูุญููู ุงูุฌุฏูุฏุฉ ุงููุทููุจุฉ:
```typescript
accountType: 'citizen' | 'mp' | 'candidate'  // ููุน ุงูุญุณุงุจ
councilId: number | null                      // ุงููุฌูุณ (ููููุงุจ ูุงููุฑุดุญูู)
partyId: number | null                        // ุงูุญุฒุจ
isIndependent: boolean                        // ูุณุชููุ
electoralSymbolId: number | null              // ุงูุฑูุฒ ุงูุงูุชุฎุงุจู
electoralNumber: string                       // ุงูุฑูู ุงูุงูุชุฎุงุจู
district: string                              // ุงูุฏุงุฆุฑุฉ ุงูุงูุชุฎุงุจูุฉ
committee: string                             // ุงููุฌูุฉ (ููููุงุจ ููุท)
```

#### ุงูุชุบููุฑุงุช ุงููุทููุจุฉ:
1. ุฅุถุงูุฉ state ููุญููู ุงูุฌุฏูุฏุฉ
2. ุฅุถุงูุฉ useEffect ูุฌูุจ councils, parties, symbols ูู Supabase
3. ุฅุถุงูุฉ dropdown "ููุน ุงูุญุณุงุจ" ูู ุจุฏุงูุฉ ุงููููุฐุฌ
4. ุฅุถุงูุฉ ุญููู conditional (ุชุธูุฑ ููุท ุนูุฏ ุงุฎุชูุงุฑ ูุงุฆุจ ุฃู ูุฑุดุญ)
5. ุชุญุฏูุซ validation
6. ุชุญุฏูุซ handleSubmit ูุฅุฑุณุงู ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ

### 1.2. ุชุญุฏูุซ `lib/auth.ts`

#### ุฅุถุงูุฉ ุฏุงูุฉ ุฌุฏูุฏุฉ:
```typescript
export async function signUpWithEmailAndProfile(data: {
  // ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ
  email: string;
  password: string;
  firstName: string;
  lastName: string;
  // ... ุจุงูู ุงูุญููู ุงูุญุงููุฉ
  
  // ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ
  accountType: 'citizen' | 'mp' | 'candidate';
  councilId?: number;
  partyId?: number;
  isIndependent?: boolean;
  electoralSymbolId?: number;
  electoralNumber?: string;
  district?: string;
  committee?: string;
}) {
  // 1. ุฅูุดุงุก user ูู auth.users
  const { data: authData, error: authError } = await supabase.auth.signUp({
    email: data.email,
    password: data.password,
  });

  if (authError) return { user: null, error: authError.message };

  // 2. ุชุญุฏูุฏ role_id ุญุณุจ accountType
  let roleId = 3; // citizen
  if (data.accountType === 'mp') roleId = 4;
  if (data.accountType === 'candidate') roleId = 5;

  // 3. ุฅูุดุงุก user ูู users table
  const { data: userData, error: userError } = await supabase
    .from('users')
    .insert({
      auth_id: authData.user?.id,
      role_id: roleId,
      first_name: data.firstName,
      last_name: data.lastName,
      email: data.email,
      phone: data.phone,
      whatsapp: data.whatsapp,
      governorate_id: data.governorateId,
      city: data.city,
      village: data.village,
      dob: data.dob,
      gender: data.gender,
      job_title: data.jobTitle,
    })
    .select()
    .single();

  if (userError) return { user: null, error: userError.message };

  // 4. ุฅุฐุง ูุงู ูุงุฆุจ ุฃู ูุฑุดุญุ ุฅูุดุงุก profile
  if (data.accountType !== 'citizen') {
    const { error: profileError } = await supabase
      .from('profiles')
      .insert({
        user_id: userData.id,
        council_id: data.councilId,
        party_id: data.partyId,
        is_independent: data.isIndependent || false,
        electoral_symbol_id: data.electoralSymbolId,
        electoral_number: data.electoralNumber,
        district: data.district,
        committee: data.committee,
      });

    if (profileError) return { user: null, error: profileError.message };
  }

  return { user: userData, error: null };
}
```

---

## ๐ ุงููุฑุญูุฉ 2: ุชุญุฏูุซ Header (1 ุณุงุนุฉ)

### 2.1. ุฅูุดุงุก `components/auth/UserMenu.tsx`

```typescript
'use client';

import { useState, useEffect } from 'react';
import Link from 'next/link';
import { useRouter } from 'next/navigation';
import { ChevronDown, LogOut, LayoutDashboard } from 'lucide-react';
import { getUser, signOut } from '@/lib/auth';

export default function UserMenu() {
  const router = useRouter();
  const [user, setUser] = useState<any>(null);
  const [isOpen, setIsOpen] = useState(false);

  useEffect(() => {
    async function fetchUser() {
      const { user } = await getUser();
      setUser(user);
    }
    fetchUser();
  }, []);

  const handleSignOut = async () => {
    await signOut();
    router.push('/');
    router.refresh();
  };

  if (!user) return null;

  const fullName = `${user.first_name || ''} ${user.last_name || ''}`.trim() || 'ุงููุณุชุฎุฏู';

  return (
    <div className="relative">
      <button
        onClick={() => setIsOpen(!isOpen)}
        className="flex items-center gap-2 px-4 py-2 text-white hover:bg-[#005707] rounded-lg transition-colors"
      >
        <span>{fullName}</span>
        <ChevronDown className="w-4 h-4" />
      </button>

      {isOpen && (
        <div className="absolute left-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-2 z-50">
          <Link
            href="/dashboard"
            className="flex items-center gap-2 px-4 py-2 text-gray-700 hover:bg-gray-100 transition-colors"
            onClick={() => setIsOpen(false)}
          >
            <LayoutDashboard className="w-4 h-4" />
            <span>ููุญุฉ ุงูุชุญูู</span>
          </Link>

          <button
            onClick={handleSignOut}
            className="flex items-center gap-2 px-4 py-2 text-red-600 hover:bg-red-50 transition-colors w-full text-right"
          >
            <LogOut className="w-4 h-4" />
            <span>ุชุณุฌูู ุงูุฎุฑูุฌ</span>
          </button>
        </div>
      )}
    </div>
  );
}
```

### 2.2. ุชุญุฏูุซ `components/layout/Header.tsx`

```typescript
// ูู ุจุฏุงูุฉ ุงูููู
import { getUser } from '@/lib/auth';
import UserMenu from '@/components/auth/UserMenu';

// ุฏุงุฎู ุงููููู
const [user, setUser] = useState<any>(null);

useEffect(() => {
  async function fetchUser() {
    const { user } = await getUser();
    setUser(user);
  }
  fetchUser();
}, []);

// ูู JSXุ ุงุณุชุจุฏุงู ุฃุฒุฑุงุฑ "ุชุณุฌูู" ู "ุฏุฎูู" ุจู:
{user ? (
  <UserMenu />
) : (
  <div className="flex gap-2">
    <Link href="/register">
      <button className="px-4 py-2 border-2 border-[#004705] text-[#004705] rounded-lg hover:bg-[#004705] hover:text-white transition-colors">
        ุชุณุฌูู
      </button>
    </Link>
    <Link href="/login">
      <button className="px-4 py-2 bg-[#004705] text-white rounded-lg hover:bg-[#005707] transition-colors">
        ุฏุฎูู
      </button>
    </Link>
  </div>
)}
```

---

## ๐ ุงููุฑุญูุฉ 3: ุตูุญุงุช ุงููููุงุช ุงูุดุฎุตูุฉ (3-4 ุณุงุนุงุช)

### 3.1. ุตูุญุฉ ุงูููุงุทู: `app/citizen/[id]/page.tsx`

```typescript
import { getUserWithProfile } from '@/lib/supabase-queries';
import { notFound } from 'next/navigation';

export default async function CitizenProfilePage({ params }: { params: { id: string } }) {
  const user = await getUserWithProfile(params.id);

  if (!user) {
    notFound();
  }

  return (
    <div className="container mx-auto px-4 py-8">
      {/* Header */}
      <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
        <div className="flex items-center gap-4">
          {user.avatar && (
            <img src={user.avatar} alt={`${user.first_name} ${user.last_name}`} className="w-24 h-24 rounded-full" />
          )}
          <div>
            <h1 className="text-3xl font-bold">{user.first_name} {user.last_name}</h1>
            <p className="text-gray-600">{user.city}, {user.governorate_id}</p>
            <p className="text-gray-600">{user.job_title}</p>
          </div>
        </div>
      </div>

      {/* ุงูุฑุณุงุฆู */}
      <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
        <h2 className="text-2xl font-bold mb-4">ุงูุฑุณุงุฆู</h2>
        {/* ูุงุฆูุฉ ุงูุฑุณุงุฆู */}
      </div>

      {/* ุงูุดูุงูู */}
      <div className="bg-white rounded-lg shadow-lg p-6">
        <h2 className="text-2xl font-bold mb-4">ุงูุดูุงูู</h2>
        {/* ูุงุฆูุฉ ุงูุดูุงูู */}
      </div>
    </div>
  );
}
```

### 3.2. ุตูุญุฉ ุงููุงุฆุจ: `app/mp/[slug]/page.tsx`

```typescript
// ูุดุงุจู ูุตูุญุฉ ุงูููุงุทู ููู ูุน ุฅุถุงูุฉ:
// - ูุนูููุงุช ุงููุฌูุณ
// - ูุนูููุงุช ุงูุญุฒุจ
// - ุงูุฏุงุฆุฑุฉ ุงูุงูุชุฎุงุจูุฉ
// - ุงูุฑูุฒ ุงูุงูุชุฎุงุจู
// - ุงูููุงุท ุงูููุชุณุจุฉ
// - ุงููุญุชูู (ุฅูุฌุงุฒุงุชุ ูุนุงููุงุชุ ุจุฑุงูุฌ)
```

### 3.3. ุตูุญุฉ ุงููุฑุดุญ: `app/candidate/[slug]/page.tsx`

```typescript
// ููุณ ุตูุญุฉ ุงููุงุฆุจ ุชูุฑูุจุงู
```

---

## ๐ ุงููุฑุญูุฉ 4: ููุญุงุช ุงูุชุญูู (4-5 ุณุงุนุงุช)

### 4.1. ููุญุฉ ุชุญูู ุงูููุงุทู: `app/dashboard/citizen/page.tsx`

```typescript
export default async function CitizenDashboard() {
  const { user } = await getUser();

  if (!user) {
    redirect('/login');
  }

  return (
    <div className="container mx-auto px-4 py-8">
      <h1 className="text-3xl font-bold mb-6">ููุญุฉ ุชุญูู ุงูููุงุทู</h1>

      {/* ููุฎุต ุงูุฅุญุตุงุฆูุงุช */}
      <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
        <div className="bg-white rounded-lg shadow-lg p-6">
          <h3 className="text-lg font-semibold mb-2">ุงูุฑุณุงุฆู</h3>
          <p className="text-3xl font-bold text-[#004705]">0</p>
        </div>

        <div className="bg-white rounded-lg shadow-lg p-6">
          <h3 className="text-lg font-semibold mb-2">ุงูุดูุงูู</h3>
          <p className="text-3xl font-bold text-[#004705]">0</p>
        </div>

        <div className="bg-white rounded-lg shadow-lg p-6">
          <h3 className="text-lg font-semibold mb-2">ุงูุดูุงูู ุงููุญูููุฉ</h3>
          <p className="text-3xl font-bold text-green-600">0</p>
        </div>
      </div>

      {/* ุฑูุงุจุท ุณุฑูุนุฉ */}
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        <Link href="/dashboard/citizen/messages" className="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow">
          <h3 className="text-xl font-semibold mb-2">ุฅุฏุงุฑุฉ ุงูุฑุณุงุฆู</h3>
          <p className="text-gray-600">ุฅุฑุณุงู ูุงุณุชูุจุงู ุงูุฑุณุงุฆู</p>
        </Link>

        <Link href="/dashboard/citizen/complaints" className="bg-white rounded-lg shadow-lg p-6 hover:shadow-xl transition-shadow">
          <h3 className="text-xl font-semibold mb-2">ุฅุฏุงุฑุฉ ุงูุดูุงูู</h3>
          <p className="text-gray-600">ุชูุฏูู ููุชุงุจุนุฉ ุงูุดูุงูู</p>
        </Link>
      </div>
    </div>
  );
}
```

### 4.2. ููุญุฉ ุชุญูู ุงููุงุฆุจ: `app/dashboard/mp/page.tsx`

```typescript
// ูุดุงุจู ููู ูุน ุฅุถุงูุฉ:
// - ุงูุดูุงูู ุงููููู ุจูุง
// - ุงูููุงุท ุงูููุชุณุจุฉ
// - ุฅุฏุงุฑุฉ ุงููุญุชูู
// - ุฅุฏุงุฑุฉ ุงูุจุงูุฑ ุงูุดุฎุตู
```

### 4.3. ููุญุฉ ุชุญูู ุงููุฑุดุญ: `app/dashboard/candidate/page.tsx`

```typescript
// ููุณ ููุญุฉ ุงููุงุฆุจ ุชูุฑูุจุงู
```

---

## ๐ ุงููููุงุช ุงููุทููุจ ุฅูุดุงุคูุง/ุชุนุฏูููุง

### ูููุงุช ุฌุฏูุฏุฉ (10 ูููุงุช)
1. `lib/supabase-queries.ts` โ (ุชู)
2. `components/auth/UserMenu.tsx`
3. `app/citizen/[id]/page.tsx`
4. `app/mp/[slug]/page.tsx`
5. `app/candidate/[slug]/page.tsx`
6. `app/dashboard/citizen/page.tsx`
7. `app/dashboard/mp/page.tsx`
8. `app/dashboard/candidate/page.tsx`
9. `app/dashboard/citizen/messages/page.tsx`
10. `app/dashboard/citizen/complaints/page.tsx`

### ูููุงุช ุชุนุฏูู (3 ูููุงุช)
1. `components/auth/RegisterForm.tsx` - ุชุญุฏูุซ ูุจูุฑ
2. `components/layout/Header.tsx` - ุชุญุฏูุซ ูุชูุณุท
3. `lib/auth.ts` - ุฅุถุงูุฉ ุฏุงูุฉ ุฌุฏูุฏุฉ

---

## โ๏ธ ุงูุชุญุฏูุงุช ุงููุชููุนุฉ

### 1. ุญุฌู ุงูุนูู ุงููุจูุฑ
- **ุงููุดููุฉ:** 13 ููู ุฌุฏูุฏ/ูุนุฏู
- **ุงูุญู:** ุชูุณูู ุงูุนูู ุฅูู ุฌูุณุงุช ูุชุนุฏุฏุฉ

### 2. ุชุนููุฏ ูููุฐุฌ ุงูุชุณุฌูู
- **ุงููุดููุฉ:** ุญููู conditional ูุนูุฏุฉ
- **ุงูุญู:** ุงุณุชุฎุฏุงู state management ุฌูุฏ

### 3. ุฌูุจ ุงูุจูุงูุงุช ูู Supabase
- **ุงููุดููุฉ:** queries ูุชุนุฏุฏุฉ ููุนูุฏุฉ
- **ุงูุญู:** ุงุณุชุฎุฏุงู `lib/supabase-queries.ts`

### 4. RLS Policies
- **ุงููุดููุฉ:** ูุฏ ุชููุน ุงููุตูู ููุจูุงูุงุช
- **ุงูุญู:** ุงูุชุฃูุฏ ูู ุฅุนุฏุงุฏ policies ุจุดูู ุตุญูุญ

---

## ๐ฏ ุงูุชูุตูุงุช

### ุงูุฎูุงุฑ 1: ุงูุชูููุฐ ุงููุงูู (10-13 ุณุงุนุฉ)
- ุชูููุฐ ุฌููุน ุงููุฑุงุญู ุฏูุนุฉ ูุงุญุฏุฉ
- **ุงููููุฒุงุช:** ูุธุงู ูุงูู ููุชูุงูู
- **ุงูุนููุจ:** ููุช ุทูููุ ุงุญุชูุงู ุฃุฎุทุงุก ูุซูุฑุฉ

### ุงูุฎูุงุฑ 2: ุงูุชูููุฐ ุงูุชุฏุฑูุฌู (ููุตู ุจู)
- **ุงููุฑุญูุฉ 1:** ุชุญุฏูุซ ูููุฐุฌ ุงูุชุณุฌูู ููุท (2-3 ุณุงุนุงุช)
- **ุงููุฑุญูุฉ 2:** ุชุญุฏูุซ Header (1 ุณุงุนุฉ)
- **ุงููุฑุญูุฉ 3:** ุตูุญุงุช ุงููููุงุช ุงูุดุฎุตูุฉ (3-4 ุณุงุนุงุช)
- **ุงููุฑุญูุฉ 4:** ููุญุงุช ุงูุชุญูู (4-5 ุณุงุนุงุช)

**ุงููููุฒุงุช:**
- ุงุฎุชุจุงุฑ ูู ูุฑุญูุฉ ูุจู ุงูุงูุชูุงู ููุชุงููุฉ
- ุชูููู ุงูุฃุฎุทุงุก
- ุฅููุงููุฉ ุงููุดุฑ ุงูุชุฏุฑูุฌู

**ุงูุนููุจ:**
- ูุญุชุงุฌ ุนุฏุฉ ุฌูุณุงุช

### ุงูุฎูุงุฑ 3: MVP (ุงูุญุฏ ุงูุฃุฏูู) (4-5 ุณุงุนุงุช)
- ุชุญุฏูุซ ูููุฐุฌ ุงูุชุณุฌูู (ูุจุณุท)
- ุชุญุฏูุซ Header
- ุตูุญุฉ ููู ุดุฎุตู ูุงุญุฏุฉ ููุท
- ููุญุฉ ุชุญูู ุจุณูุทุฉ ูุงุญุฏุฉ

---

## ๐ค ูุง ูู ุงูุฎูุงุฑ ุงูุฃูุถูุ

**ุฃูุตู ุจุงูุฎูุงุฑ 2 (ุงูุชูููุฐ ุงูุชุฏุฑูุฌู)** ูุฃูู:
1. ูุถูู ุฌูุฏุฉ ุงูููุฏ
2. ูุณูู ุงูุงุฎุชุจุงุฑ
3. ูููู ุงูุฃุฎุทุงุก
4. ูููู ูุดุฑ ูู ูุฑุญูุฉ ุนูู ุญุฏุฉ

---

## ๐ ุงููุฑุงุฑ ุงูุชุงูู

**ูุฑุฌู ุงุฎุชูุงุฑ ุฃุญุฏ ุงูุฎูุงุฑุงุช:**

1. **ุงูุฎูุงุฑ 1:** ุงุจุฏุฃ ุงูุชูููุฐ ุงููุงูู ุงูุขู (10-13 ุณุงุนุฉ)
2. **ุงูุฎูุงุฑ 2:** ุงุจุฏุฃ ุจุงููุฑุญูุฉ 1 ููุท (ุชุญุฏูุซ ูููุฐุฌ ุงูุชุณุฌูู) (2-3 ุณุงุนุงุช)
3. **ุงูุฎูุงุฑ 3:** ุงุจุฏุฃ ุจู MVP (ุงูุญุฏ ุงูุฃุฏูู) (4-5 ุณุงุนุงุช)
4. **ุฎูุงุฑ ุขุฎุฑ:** ุญุฏุฏ ูุง ุชุฑูุฏู ุจุงูุถุจุท

---

**ุชุงุฑูุฎ ุงูุฅูุดุงุก:** 2025-10-06  
**ุงูุฅุตุฏุงุฑ ุงููุณุชูุฏู:** v1.3.0  
**ุงูุญุงูุฉ:** โธ๏ธ ูู ุงูุชุธุงุฑ ุงููุฑุงุฑ
